const _0x5a752a=_0x1a98;(function(_0x9c21a3,_0x16ef56){const _0x4f3b17=_0x1a98,_0x3aa56=_0x9c21a3();while(!![]){try{const _0x3f5c70=-parseInt(_0x4f3b17(0x1c2))/0x1*(parseInt(_0x4f3b17(0x1da))/0x2)+-parseInt(_0x4f3b17(0x1b9))/0x3+-parseInt(_0x4f3b17(0x1df))/0x4+-parseInt(_0x4f3b17(0x1c3))/0x5*(parseInt(_0x4f3b17(0x1f3))/0x6)+-parseInt(_0x4f3b17(0x205))/0x7+parseInt(_0x4f3b17(0x1c8))/0x8*(-parseInt(_0x4f3b17(0x1ea))/0x9)+parseInt(_0x4f3b17(0x20c))/0xa;if(_0x3f5c70===_0x16ef56)break;else _0x3aa56['push'](_0x3aa56['shift']());}catch(_0x5839f5){_0x3aa56['push'](_0x3aa56['shift']());}}}(_0x284a,0xb6d13));import{ethers as _0x587ea2}from'ethers';import{Config as _0x50514c}from'../../config.js';function _0x1a98(_0x2458cd,_0x58ae71){const _0x284a94=_0x284a();return _0x1a98=function(_0x1a98d9,_0x4121a3){_0x1a98d9=_0x1a98d9-0x1b8;let _0x4d7dbf=_0x284a94[_0x1a98d9];return _0x4d7dbf;},_0x1a98(_0x2458cd,_0x58ae71);}import{NETWORKS as _0x32b014,CONTRACTS as _0x25509c,ABIS as _0x475c50,DEST_BLOCKCHAIN_ID as _0x2e4cff}from'../core/network.js';async function pureDelay(_0x264466){return new Promise(_0x2da021=>setTimeout(_0x2da021,_0x264466));}function _0x284a(){const _0x32c268=['ZERO_ADDRESS','initiate','formatUnits','Contract','[INFO]\x20Checking\x20for\x20any\x20remaining\x20USDT\x20to\x20swap\x20back\x20to\x20KITE.','[INFO]\x20Swap\x20','[INFO]\x20Swapping\x20remaining\x20','\x20USDT\x20back\x20to\x20KITE.','0x0000000000000000000000000000000000000002','[INFO]\x20Starting\x20swap\x20cycle...','24075hNvsqb','[INFO]\x20Approving\x20USDT\x20for\x20swap...','[WARN]\x20Low\x20KITE\x20balance\x20on\x20EOA.\x20Attempting\x20to\x20withdraw\x200.1\x20KITE\x20from\x20SA\x20for\x20gas\x20fees.','[INFO]\x20Sending\x20swap\x20transaction...','formatEther','[ERROR]\x20Failed\x20during\x20gas\x20check/withdrawal\x20process:\x20','uint256','provider','balanceOf','18NILSBi','MAX_SWAP_COUNT','Swap\x20cycle\x20Error','toString','approve','USDT_TO_KITE','addDebugMessage','wait','updateStatus','defaultAbiCoder','[INFO]\x20Amount:\x20','[ERROR]\x20Final\x20USDT\x20cleanup\x20swap\x20failed:\x20','[SUCCESS]\x20USDT\x20approved\x20successfully.','toFixed','address','AbiCoder','uint8','KITE_AI','8964060OqPfvq','\x20->\x20','allowance','SWAP_ROUTER','buildInstructionsData','executeSwapCycle','encode','73166130oQvMTn','withdrawService','refreshEoaBalance','\x20KITE','2543979AWJMFd','getBalance','[INFO]\x20Estimating\x20gas\x20for\x20swap...','withdrawNativeKite','USDT','floor','\x20balance\x20for\x20swap.\x20Skipping.','Swap\x20Completed','_executeSwap','1CTcqPQ','2057525pYYUFr','WKITE','[WARN]\x20Insufficient\x20','random','[SUCCESS]\x20Final\x20cleanup\x20swap\x20successful!\x20Tx:\x20','3704IxnJJh','RPC_URL','decimals','ERC20','KITE_TO_USDT','MIN_SWAP_COUNT','KITE','s\x20before\x20next\x20swap...','[INFO]\x20EOA\x20KITE\x20balance\x20for\x20gas:\x20','JsonRpcProvider','dashboard','message','/3\x20failed:\x20','Wallet','[SUCCESS]\x20Swap\x20successful!\x20Tx:\x20','[SUCCESS]\x20Swap\x20cycle\x20finished.','ceil','truncateAddress','2853022HEEaJf','parseUnits','[INFO]\x20Performing\x20','gasLimit','Processing\x20Swap..','2158680wTCsCb'];_0x284a=function(){return _0x32c268;};return _0x284a();}function getRandomInt(_0x57f388,_0x3dc396){const _0x3336c5=_0x1a98;return _0x57f388=Math[_0x3336c5(0x1d8)](_0x57f388),Math['floor'](Math[_0x3336c5(0x1c6)]()*((_0x3dc396=Math[_0x3336c5(0x1be)](_0x3dc396))-_0x57f388+0x1))+_0x57f388;}export class SwapService{constructor(_0x245c4d,_0x1d60dc){const _0x1fcace=_0x1a98;this['dashboard']=_0x245c4d,this[_0x1fcace(0x20d)]=_0x1d60dc,this[_0x1fcace(0x1f1)]=new _0x587ea2[(_0x1fcace(0x1d1))](_0x32b014[_0x1fcace(0x204)][_0x1fcace(0x1c9)]);}[_0x5a752a(0x209)](_0x205565,_0x46312f,_0xacde27,_0x4e43f4){const _0xdced50=_0x5a752a;let _0x1ad55f=_0x587ea2[_0xdced50(0x202)][_0xdced50(0x1fc)]()[_0xdced50(0x20b)](['uint8',_0xdced50(0x203),_0xdced50(0x1f0),'uint256',_0xdced50(0x201),'address',_0xdced50(0x201)],[0x20,0x60,0x0,0x0,_0xdced50(0x1e8),_0xacde27,_0x4e43f4]);return[0x1,_0x205565,!_0x46312f,_0x205565,0x0,0x7a120,[[0x3,0x27fa60,0x205940,_0x1ad55f,[_0x25509c[_0xdced50(0x1e0)],!0x1,_0x25509c[_0xdced50(0x1e0)],_0x25509c['SWAP_ROUTER'],_0x2e4cff,0x0,0x0]]]];}async[_0x5a752a(0x1c1)](_0x9021e9,_0x3a2a7e,_0xfbc998,_0x59d06c,_0x3b0a3a,_0x5c398f){const _0x4dd026=_0x5a752a;let _0x336991=new _0x587ea2[(_0x4dd026(0x1d5))](_0x9021e9,this[_0x4dd026(0x1f1)]),_0x26959b=_0x336991[_0x4dd026(0x201)],_0xb35c61=_0x4dd026(0x1cc)===_0x3a2a7e,_0x1823da=_0x587ea2[_0x4dd026(0x1db)](_0x3b0a3a,_0x5c398f),_0x294b62=new _0x587ea2['Contract'](_0x25509c[_0x4dd026(0x208)],_0x475c50[_0x4dd026(0x208)],_0x336991);if(!_0xb35c61){let _0x14acef=new _0x587ea2['Contract'](_0xfbc998,_0x475c50[_0x4dd026(0x1cb)],_0x336991);this[_0x4dd026(0x1d2)][_0x4dd026(0x1f9)]('[INFO]\x20Checking\x20USDT\x20allowance\x20for\x20swap...');let _0x3e8b7c=await _0x14acef[_0x4dd026(0x207)](_0x26959b,_0x25509c[_0x4dd026(0x208)]);if(_0x3e8b7c<_0x1823da){this[_0x4dd026(0x1d2)][_0x4dd026(0x1f9)](_0x4dd026(0x1eb));let _0x45da14=await _0x14acef[_0x4dd026(0x1f7)](_0x25509c[_0x4dd026(0x208)],_0x1823da);await _0x45da14[_0x4dd026(0x1fa)](),this['dashboard'][_0x4dd026(0x1f9)](_0x4dd026(0x1ff));}}let _0x392c6b=this['buildInstructionsData'](_0x26959b,_0xb35c61,_0xfbc998,_0x59d06c),_0x2b44b6=_0xb35c61?_0x25509c[_0x4dd026(0x1e0)]:_0xfbc998,_0x6b9d42=[_0x2b44b6,_0x1823da,_0x392c6b],_0x144e95=_0xb35c61?{'value':_0x1823da}:{};this['dashboard'][_0x4dd026(0x1f9)](_0x4dd026(0x1bb));let _0x23661b=await _0x294b62['initiate']['estimateGas'](..._0x6b9d42,_0x144e95);_0x144e95[_0x4dd026(0x1dd)]=0x78n*_0x23661b/0x64n,this['dashboard'][_0x4dd026(0x1f9)](_0x4dd026(0x1ed));let _0x3150c1=await _0x294b62[_0x4dd026(0x1e1)](..._0x6b9d42,_0x144e95);return await _0x3150c1[_0x4dd026(0x1fa)](),_0x3150c1['hash'];}async[_0x5a752a(0x20a)](_0x212bed,_0x2eb339,_0x5a3492){const _0x1d76ea=_0x5a752a;this[_0x1d76ea(0x1d2)][_0x1d76ea(0x1f9)](_0x1d76ea(0x1e9)),_0x2eb339[_0x1d76ea(0x1fb)]('Starting\x20Swap\x20Cycle..');let _0x5373f8=new _0x587ea2['Wallet'](_0x212bed,this[_0x1d76ea(0x1f1)]),_0x3589a9=_0x5373f8['address'];try{let _0x1bbe27=await this[_0x1d76ea(0x1f1)][_0x1d76ea(0x1ba)](_0x3589a9),_0xceaddd=parseFloat(_0x587ea2[_0x1d76ea(0x1ee)](_0x1bbe27));this[_0x1d76ea(0x1d2)][_0x1d76ea(0x1f9)](_0x1d76ea(0x1d0)+_0xceaddd[_0x1d76ea(0x200)](0x4)+_0x1d76ea(0x1b8)),_0xceaddd<0.01&&(this['dashboard'][_0x1d76ea(0x1f9)](_0x1d76ea(0x1ec)),await this[_0x1d76ea(0x20d)][_0x1d76ea(0x1bc)](_0x5a3492,0.1,_0x2eb339),this[_0x1d76ea(0x1d2)][_0x1d76ea(0x1f9)]('[INFO]\x20Waiting\x2030s\x20for\x20withdrawal\x20to\x20confirm...'),await pureDelay(0x7530));}catch(_0x57bf35){this[_0x1d76ea(0x1d2)]['addDebugMessage'](_0x1d76ea(0x1ef)+_0x57bf35[_0x1d76ea(0x1d3)]);}let _0x16c30c=getRandomInt(_0x50514c[_0x1d76ea(0x1cd)],_0x50514c[_0x1d76ea(0x1f4)])||getRandomInt(0xa,0x14);this['dashboard'][_0x1d76ea(0x1f9)](_0x1d76ea(0x1dc)+_0x16c30c+'\x20alternating\x20swap(s).');let _0x3fae9d=_0x1d76ea(0x1cc);for(let _0x14a38e=0x0;_0x14a38e<_0x16c30c;_0x14a38e++){await _0x2eb339[_0x1d76ea(0x20e)](),await _0x2eb339[_0x1d76ea(0x1fb)](_0x1d76ea(0x1de));let _0x1847b9,_0x321319,_0x4fbd6a,_0x2bc696,_0x44876c,_0x1a12f7,_0x23fbc9=new _0x587ea2[(_0x1d76ea(0x1e3))](_0x25509c['USDT'],_0x475c50['ERC20'],this[_0x1d76ea(0x1f1)]),_0x2c5203=await _0x23fbc9[_0x1d76ea(0x1ca)]();if(_0x1d76ea(0x1cc)===_0x3fae9d){if(_0x1847b9=_0x25509c[_0x1d76ea(0x1c4)],_0x321319=_0x25509c['USDT'],_0x4fbd6a=(getRandomInt(0x1,0x5)/0x64)[_0x1d76ea(0x1f6)](),_0x2bc696=_0x587ea2[_0x1d76ea(0x1ee)](await this['provider'][_0x1d76ea(0x1ba)](_0x3589a9)),_0x44876c=_0x1d76ea(0x1ce),_0x1a12f7=0x12,parseFloat(_0x2bc696)<parseFloat(_0x4fbd6a)){this['dashboard'][_0x1d76ea(0x1f9)](_0x1d76ea(0x1c5)+_0x44876c+_0x1d76ea(0x1bf)),_0x3fae9d='USDT_TO_KITE';continue;}}else{if(_0x1847b9=_0x25509c[_0x1d76ea(0x1bd)],_0x321319=_0x25509c[_0x1d76ea(0x1c4)],_0x4fbd6a=_0x2bc696=_0x587ea2['formatUnits'](await _0x23fbc9[_0x1d76ea(0x1f2)](_0x3589a9),_0x2c5203),_0x44876c=_0x1d76ea(0x1bd),_0x1a12f7=_0x2c5203,0.0001>parseFloat(_0x4fbd6a)){this[_0x1d76ea(0x1d2)][_0x1d76ea(0x1f9)](_0x1d76ea(0x1c5)+_0x44876c+_0x1d76ea(0x1bf)),_0x3fae9d=_0x1d76ea(0x1cc);continue;}}this[_0x1d76ea(0x1d2)][_0x1d76ea(0x1f9)](_0x1d76ea(0x1e5)+(_0x14a38e+0x1)+'/'+_0x16c30c+':\x20'+_0x44876c+_0x1d76ea(0x206)+(_0x1d76ea(0x1cc)===_0x3fae9d?_0x1d76ea(0x1bd):'KITE')),this[_0x1d76ea(0x1d2)][_0x1d76ea(0x1f9)](_0x1d76ea(0x1fd)+_0x4fbd6a+'\x20'+_0x44876c+',\x20Balance:\x20'+parseFloat(_0x2bc696)[_0x1d76ea(0x200)](0x4)+'\x20'+_0x44876c);let _0x31ccf6=!0x1,_0x7e163b=0x0;for(;!_0x31ccf6&&_0x7e163b<0x3;){_0x7e163b++;try{let _0x940894=await this[_0x1d76ea(0x1c1)](_0x212bed,_0x3fae9d,_0x1847b9,_0x321319,_0x4fbd6a,_0x1a12f7);this[_0x1d76ea(0x1d2)][_0x1d76ea(0x1f9)](_0x1d76ea(0x1d6)+this[_0x1d76ea(0x1d2)]['truncateAddress'](_0x940894)),_0x31ccf6=!0x0,await _0x2eb339[_0x1d76ea(0x1fb)](_0x1d76ea(0x1c0));}catch(_0x4f6cac){this['dashboard'][_0x1d76ea(0x1f9)]('[ERROR]\x20Swap\x20attempt\x20'+_0x7e163b+_0x1d76ea(0x1d4)+_0x4f6cac[_0x1d76ea(0x1d3)]),_0x7e163b<0x3?await pureDelay(0x1388):_0x2eb339[_0x1d76ea(0x1fb)]('Swap\x20Failed');}}if(_0x3fae9d=_0x1d76ea(0x1cc)===_0x3fae9d?_0x1d76ea(0x1f8):_0x1d76ea(0x1cc),_0x14a38e<_0x16c30c-0x1){let _0xfc5d2c=getRandomInt(0x5,0x14);this['dashboard'][_0x1d76ea(0x1f9)]('[INFO]\x20Waiting\x20~'+_0xfc5d2c+_0x1d76ea(0x1cf)),await pureDelay(0x457*_0xfc5d2c);}}this['dashboard'][_0x1d76ea(0x1f9)](_0x1d76ea(0x1e4));try{await _0x2eb339[_0x1d76ea(0x20e)]();let _0x1f93fa=new _0x587ea2[(_0x1d76ea(0x1e3))](_0x25509c[_0x1d76ea(0x1bd)],_0x475c50['ERC20'],this[_0x1d76ea(0x1f1)]),_0x2df95c=await _0x1f93fa[_0x1d76ea(0x1ca)](),_0x32779a=_0x587ea2[_0x1d76ea(0x1e2)](await _0x1f93fa[_0x1d76ea(0x1f2)](_0x3589a9),_0x2df95c);if(parseFloat(_0x32779a)>=0.01){this[_0x1d76ea(0x1d2)][_0x1d76ea(0x1f9)](_0x1d76ea(0x1e6)+_0x32779a+_0x1d76ea(0x1e7));let _0x58912c=await this['_executeSwap'](_0x212bed,_0x1d76ea(0x1f8),_0x25509c[_0x1d76ea(0x1bd)],_0x25509c[_0x1d76ea(0x1c4)],_0x32779a,_0x2df95c);this['dashboard'][_0x1d76ea(0x1f9)](_0x1d76ea(0x1c7)+this['dashboard'][_0x1d76ea(0x1d9)](_0x58912c));}else this['dashboard']['addDebugMessage']('[INFO]\x20No\x20remaining\x20USDT\x20to\x20swap.');}catch(_0x179133){this['dashboard'][_0x1d76ea(0x1f9)](_0x1d76ea(0x1fe)+_0x179133[_0x1d76ea(0x1d3)]),_0x2eb339[_0x1d76ea(0x1fb)](_0x1d76ea(0x1f5));}this['dashboard'][_0x1d76ea(0x1f9)](_0x1d76ea(0x1d7));}}