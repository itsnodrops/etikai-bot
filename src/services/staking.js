function _0x3899(_0x53a4da,_0x1ff0dd){const _0x5f1eaf=_0x5f1e();return _0x3899=function(_0x389912,_0x3595f6){_0x389912=_0x389912-0x1c9;let _0x527919=_0x5f1eaf[_0x389912];return _0x527919;},_0x3899(_0x53a4da,_0x1ff0dd);}const _0x574b68=_0x3899;(function(_0x14927c,_0x1cfbde){const _0x3cec2e=_0x3899,_0x422ff4=_0x14927c();while(!![]){try{const _0x405de1=parseInt(_0x3cec2e(0x1d9))/0x1*(parseInt(_0x3cec2e(0x1fc))/0x2)+-parseInt(_0x3cec2e(0x20b))/0x3*(-parseInt(_0x3cec2e(0x21f))/0x4)+-parseInt(_0x3cec2e(0x1dc))/0x5+parseInt(_0x3cec2e(0x1f8))/0x6*(parseInt(_0x3cec2e(0x209))/0x7)+-parseInt(_0x3cec2e(0x1d7))/0x8*(-parseInt(_0x3cec2e(0x223))/0x9)+-parseInt(_0x3cec2e(0x1da))/0xa*(-parseInt(_0x3cec2e(0x1d5))/0xb)+parseInt(_0x3cec2e(0x1cf))/0xc;if(_0x405de1===_0x1cfbde)break;else _0x422ff4['push'](_0x422ff4['shift']());}catch(_0x2012af){_0x422ff4['push'](_0x422ff4['shift']());}}}(_0x5f1e,0x27a19));import{API_ENDPOINTS as _0x2933aa}from'../core/api.js';let GENERAL_MAX_ATTEMPTS=0x5,GENERAL_RETRY_DELAY_MS=0x7530,DELAY_BETWEEN_ACTIONS_SEC_MIN=0x5,DELAY_BETWEEN_ACTIONS_SEC_MAX=0xf,POST_UNSTAKE_DELAY_SEC=0x5a;async function pureDelay(_0x31db6e){return new Promise(_0x26a374=>setTimeout(_0x26a374,_0x31db6e));}function _0x5f1e(){const _0x1cd821=['\x20attempt\x20','Unstaking\x20from\x20','[ERROR]\x20FetchMarketSubnets\x20failed\x20after\x20all\x20retries.','N/A','\x20Fail\x20','\x20KITE\x20in\x20the\x20first\x20available\x20subnet.','https://testnet.gokite.ai/','filter','Getting\x20Staked\x20Info..','471982jkGJbz','\x20active.','381TwqdpU','Staking\x20in\x20','message','\x20(Attempt\x20','[WARN]\x20FetchMarketSubnets\x20attempt\x20','[SUCCESS]\x20Unstake\x20from\x20','Unstake\x20&\x20Restake\x20Cycle','updateStakedAmount','number','current_apr','\x20FAILED\x20(Max\x20Retries)','userAgent','\x20process\x20complete.\x20','displayed_name','error','executeUnstakeAndRestakeCycle','[SUCCESS]\x20User\x27s\x20Total\x20Staked:\x20','data','Error\x20Market\x20Subnets','Could\x20not\x20fetch\x20market\x20subnets.\x20Msg:\x20','1172ipAwLR','ALL_MARKET_SUBNETS','Market\x20Subnets\x20Fetched','refreshSmartAccountBalance','45ylMxnv','api','floor','[ERROR]\x20Failed\x20to\x20unstake\x20from\x20','userStakedInfo','dashboard','POST','[SUCCESS]\x20Staked\x20in\x20','updateStatus','[WARN]\x20','[INFO]\x20No\x20stake\x20to\x20remove\x20from\x20','.\x20Retry\x20in\x2030s','640404LlJBzZ','\x20failed:\x20','\x20subnets\x20to\x20unstake\x20from.','address','fetch','Unstaking\x20from\x20all\x20subnets','11121PghlWX','allMarketSubnets','146648sfpVlT','total_staked_amount','46NwcMCO','1370AHKZJw','...','1602705YIdVrB','unstakeFromAllSubnets','length','[ERROR]\x20Failed\x20to\x20stake\x20in\x20','[INFO]\x20Found\x20','[WARN]\x20No\x20available\x20subnets\x20to\x20stake\x20in.','[SUCCESS]\x20Fetched\x20','[INFO]\x20Waiting\x2090s\x20for\x20balance\x20to\x20update\x20after\x20unstaking...','random','sessionManager','Bearer\x20','Could\x20not\x20get\x20user\x27s\x20staked\x20summary.\x20Msg:\x20','DELEGATE_STAKE','success','isArray','[INFO]\x20Starting\x20unstake\x20and\x20restake\x20cycle.','[INFO]\x20Amount\x20per\x20subnet\x20is\x20less\x20than\x201.\x20Staking\x20total\x20of\x20','availableSubnetsForStaking','addDebugMessage','_unstakeFromSubnet','API\x20error\x20during\x20unstake:\x20','\x20Succeeded','getUserStakedAmount','\x20market\x20subnets.\x20','staked_subnets','GET','Staking\x20evenly\x20in\x20subnets','\x20subnets.','12FvErVW','[ERROR]\x20GetUserStakedAmount\x20failed\x20after\x20all\x20retries.','USER_STAKED_INFO','fetchAvailableMarketSubnets','1186HYcwqm','[WARN]\x20GetUserStakedAmount\x20attempt\x20','[INFO]\x20Staking\x20','stringify'];_0x5f1e=function(){return _0x1cd821;};return _0x5f1e();}function random(_0x216fcd,_0x54ab4e){const _0x42dfcd=_0x3899;return Math[_0x42dfcd(0x225)](Math[_0x42dfcd(0x1e4)]()*(_0x54ab4e-_0x216fcd+0x1))+_0x216fcd;}export class StakingService{constructor(_0x5ae473,_0x11d24b,_0x2a70f2){const _0x143f1d=_0x3899;this[_0x143f1d(0x224)]=_0x5ae473,this[_0x143f1d(0x228)]=_0x11d24b,this[_0x143f1d(0x1e5)]=_0x2a70f2,this[_0x143f1d(0x227)]={'total_staked_amount':0x0,'staked_subnets':[]},this[_0x143f1d(0x1ed)]=[],this['allMarketSubnets']=[];}async[_0x574b68(0x1f2)](_0x49132d,_0x285248,_0x2b0912=!0x0){const _0x1661ab=_0x574b68;let _0xaa8deb=[0x2bf20,0x33450,0x493e0];for(let _0x15dcc3=0x0;_0x15dcc3<_0xaa8deb['length'];_0x15dcc3++)try{_0x2b0912&&_0x285248[_0x1661ab(0x1cb)](_0x1661ab(0x208));let _0x3c4098=await this[_0x1661ab(0x224)]['fetch'](_0x2933aa[_0x1661ab(0x1fa)],_0x1661ab(0x1f5),_0x1661ab(0x1e6)+_0x49132d,{},{'Referer':'https://testnet.gokite.ai/'},_0xaa8deb[_0x15dcc3],_0x285248[_0x1661ab(0x216)]);if(_0x3c4098[_0x1661ab(0x219)]||!_0x3c4098[_0x1661ab(0x21c)]?.[_0x1661ab(0x21c)])throw Error(_0x1661ab(0x1e7)+(_0x3c4098[_0x1661ab(0x20d)]||JSON[_0x1661ab(0x1ff)](_0x3c4098[_0x1661ab(0x21c)])));return this[_0x1661ab(0x227)]=_0x3c4098[_0x1661ab(0x21c)][_0x1661ab(0x21c)],this[_0x1661ab(0x227)][_0x1661ab(0x1f4)]||(this[_0x1661ab(0x227)][_0x1661ab(0x1f4)]=[]),_0x2b0912&&this['dashboard'][_0x1661ab(0x1ee)](_0x1661ab(0x21b)+(this[_0x1661ab(0x227)][_0x1661ab(0x1d8)]||_0x1661ab(0x203))+'.'),_0x285248[_0x1661ab(0x212)](this[_0x1661ab(0x227)][_0x1661ab(0x1d8)]),_0x2b0912&&_0x285248['updateStatus']('User\x20Stakes\x20Updated'),this[_0x1661ab(0x227)];}catch(_0x5d09d0){if(this[_0x1661ab(0x228)]['addDebugMessage'](_0x1661ab(0x1fd)+(_0x15dcc3+0x1)+_0x1661ab(0x1d0)+_0x5d09d0['message']),_0x15dcc3<_0xaa8deb[_0x1661ab(0x1de)]-0x1)await pureDelay(0x1388);else throw this['dashboard']['addDebugMessage'](_0x1661ab(0x1f9)),_0x285248[_0x1661ab(0x1cb)]('Error\x20User\x20Stakes'),this['userStakedInfo']={'total_staked_amount':0x0,'staked_subnets':[]},_0x285248[_0x1661ab(0x212)](0x0),_0x5d09d0;}}async[_0x574b68(0x1fb)](_0x31d7c6,_0x5b25b6){const _0x5a3366=_0x574b68;let _0x4602d9=[0x2bf20,0x33450,0x493e0];for(let _0x588d19=0x0;_0x588d19<_0x4602d9[_0x5a3366(0x1de)];_0x588d19++)try{_0x5b25b6[_0x5a3366(0x1cb)]('Fetching\x20Subnets..');let _0x2c3f8f=await this['api']['fetch'](_0x2933aa[_0x5a3366(0x220)],_0x5a3366(0x1f5),_0x5a3366(0x1e6)+_0x31d7c6,{},{'Referer':_0x5a3366(0x206)},_0x4602d9[_0x588d19],_0x5b25b6[_0x5a3366(0x216)]);if(_0x2c3f8f[_0x5a3366(0x219)]||!_0x2c3f8f[_0x5a3366(0x21c)]?.[_0x5a3366(0x21c)]||!Array[_0x5a3366(0x1ea)](_0x2c3f8f[_0x5a3366(0x21c)][_0x5a3366(0x21c)]))throw Error(_0x5a3366(0x21e)+(_0x2c3f8f[_0x5a3366(0x20d)]||JSON[_0x5a3366(0x1ff)](_0x2c3f8f[_0x5a3366(0x21c)])));this[_0x5a3366(0x1d6)]=_0x2c3f8f[_0x5a3366(0x21c)][_0x5a3366(0x21c)][_0x5a3366(0x207)](_0x2a7220=>_0x2a7220&&_0x2a7220['id']&&_0x2a7220[_0x5a3366(0x1d2)]),this['availableSubnetsForStaking']=this[_0x5a3366(0x1d6)][_0x5a3366(0x207)](_0xa4e147=>_0x5a3366(0x213)==typeof _0xa4e147[_0x5a3366(0x214)]&&_0xa4e147['current_apr']>0x0),this['dashboard'][_0x5a3366(0x1ee)](_0x5a3366(0x1e2)+this[_0x5a3366(0x1d6)][_0x5a3366(0x1de)]+_0x5a3366(0x1f3)+this['availableSubnetsForStaking'][_0x5a3366(0x1de)]+_0x5a3366(0x20a)),_0x5b25b6['updateStatus'](_0x5a3366(0x221));return;}catch(_0x16ecc1){if(this[_0x5a3366(0x228)][_0x5a3366(0x1ee)](_0x5a3366(0x20f)+(_0x588d19+0x1)+'\x20failed:\x20'+_0x16ecc1[_0x5a3366(0x20d)]),_0x588d19<_0x4602d9[_0x5a3366(0x1de)]-0x1)await pureDelay(0x1388);else throw this[_0x5a3366(0x228)][_0x5a3366(0x1ee)](_0x5a3366(0x202)),_0x5b25b6[_0x5a3366(0x1cb)](_0x5a3366(0x21d)),this[_0x5a3366(0x1d6)]=[],this[_0x5a3366(0x1ed)]=[],_0x16ecc1;}}async[_0x574b68(0x1ef)](_0x437eec,_0x2a3554,_0x242a0b){const _0x69a3bf=_0x574b68;let {address:_0x381112,my_staked_amount:_0x6151df}=_0x2a3554,_0xc19943=Math[_0x69a3bf(0x225)](parseFloat(_0x6151df));if(_0xc19943<=0x0)return this['dashboard'][_0x69a3bf(0x1ee)](_0x69a3bf(0x1cd)+_0x2a3554['displayed_name']+'.'),!0x0;_0x242a0b[_0x69a3bf(0x1cb)](_0x69a3bf(0x201)+_0x2a3554[_0x69a3bf(0x218)]),this[_0x69a3bf(0x228)][_0x69a3bf(0x1ee)]('[INFO]\x20Attempting\x20to\x20unstake\x20'+_0xc19943+'\x20KITE\x20from\x20'+_0x2a3554[_0x69a3bf(0x218)]+_0x69a3bf(0x1db));try{let _0x5d2dbd=await this[_0x69a3bf(0x224)][_0x69a3bf(0x1d3)](_0x2933aa['UNDELEGATE_STAKE'],_0x69a3bf(0x1c9),_0x69a3bf(0x1e6)+_0x437eec,{'subnet_address':_0x381112,'amount':_0xc19943},{'Referer':_0x69a3bf(0x206)},void 0x0,_0x242a0b[_0x69a3bf(0x216)]);if(_0x5d2dbd[_0x69a3bf(0x219)])throw Error(_0x69a3bf(0x1f0)+(_0x5d2dbd[_0x69a3bf(0x20d)]||JSON[_0x69a3bf(0x1ff)](_0x5d2dbd['data'])));return this[_0x69a3bf(0x228)]['addDebugMessage'](_0x69a3bf(0x210)+_0x2a3554[_0x69a3bf(0x218)]+'\x20successful.'),!0x0;}catch(_0x4d8e26){return this[_0x69a3bf(0x228)][_0x69a3bf(0x1ee)](_0x69a3bf(0x226)+_0x2a3554['displayed_name']+':\x20'+_0x4d8e26[_0x69a3bf(0x20d)]),!0x1;}}async[_0x574b68(0x1dd)](_0x1fc4a9,_0x3365e5){const _0xb7bd66=_0x574b68;_0x3365e5[_0xb7bd66(0x1cb)](_0xb7bd66(0x1d4)),await this[_0xb7bd66(0x1f2)](_0x1fc4a9,_0x3365e5);let _0x2e9516=this[_0xb7bd66(0x227)]['staked_subnets']||[];if(0x0===_0x2e9516[_0xb7bd66(0x1de)])return this[_0xb7bd66(0x228)][_0xb7bd66(0x1ee)]('[INFO]\x20No\x20subnets\x20to\x20unstake\x20from.'),!0x1;for(let _0x35fb20 of(this[_0xb7bd66(0x228)][_0xb7bd66(0x1ee)](_0xb7bd66(0x1e0)+_0x2e9516[_0xb7bd66(0x1de)]+_0xb7bd66(0x1d1)),_0x2e9516))await this[_0xb7bd66(0x1ef)](_0x1fc4a9,_0x35fb20,_0x3365e5),await pureDelay(0x3e8*random(0x5,0xf));return!0x0;}async['stakeEvenlyAcrossSubnets'](_0x68216f,_0x28a9f7){const _0x5e2823=_0x574b68;if(_0x28a9f7[_0x5e2823(0x1cb)](_0x5e2823(0x1f6)),await this['fetchAvailableMarketSubnets'](_0x68216f,_0x28a9f7),0x0===this[_0x5e2823(0x1ed)][_0x5e2823(0x1de)]){this['dashboard'][_0x5e2823(0x1ee)](_0x5e2823(0x1e1));return;}let _0x2b9d11=await _0x28a9f7[_0x5e2823(0x222)](_0x68216f),_0x23ab54=parseFloat(_0x2b9d11);if(_0x23ab54<0x1){this[_0x5e2823(0x228)]['addDebugMessage']('[INFO]\x20Balance\x20is\x20less\x20than\x201\x20KITE,\x20nothing\x20to\x20stake.');return;}let _0x54a209=Math[_0x5e2823(0x225)](_0x23ab54/this[_0x5e2823(0x1ed)]['length']);if(_0x54a209<0x1){let _0x3afe33=Math[_0x5e2823(0x225)](_0x23ab54);this[_0x5e2823(0x228)]['addDebugMessage'](_0x5e2823(0x1ec)+_0x3afe33+_0x5e2823(0x205));let _0x23191b=this['availableSubnetsForStaking'][0x0];try{await this[_0x5e2823(0x224)][_0x5e2823(0x1d3)](_0x2933aa[_0x5e2823(0x1e8)],_0x5e2823(0x1c9),_0x5e2823(0x1e6)+_0x68216f,{'subnet_address':_0x23191b[_0x5e2823(0x1d2)],'amount':_0x3afe33},{'Referer':_0x5e2823(0x206)},void 0x0,_0x28a9f7[_0x5e2823(0x216)]),this['dashboard'][_0x5e2823(0x1ee)](_0x5e2823(0x1ca)+_0x23191b[_0x5e2823(0x218)]);}catch(_0x3e5aa){this[_0x5e2823(0x228)]['addDebugMessage'](_0x5e2823(0x1df)+_0x23191b[_0x5e2823(0x218)]+':\x20'+_0x3e5aa[_0x5e2823(0x20d)]);}return;}for(let _0x53620c of(this[_0x5e2823(0x228)]['addDebugMessage'](_0x5e2823(0x1fe)+_0x54a209+'\x20KITE\x20in\x20each\x20of\x20'+this['availableSubnetsForStaking']['length']+_0x5e2823(0x1f7)),this[_0x5e2823(0x1ed)])){try{_0x28a9f7[_0x5e2823(0x1cb)](_0x5e2823(0x20c)+_0x53620c[_0x5e2823(0x218)]);let _0x3e9aae=await this[_0x5e2823(0x224)][_0x5e2823(0x1d3)](_0x2933aa['DELEGATE_STAKE'],_0x5e2823(0x1c9),_0x5e2823(0x1e6)+_0x68216f,{'subnet_address':_0x53620c[_0x5e2823(0x1d2)],'amount':_0x54a209},{'Referer':'https://testnet.gokite.ai/'},void 0x0,_0x28a9f7[_0x5e2823(0x216)]);if(_0x3e9aae[_0x5e2823(0x219)])throw Error(_0x3e9aae[_0x5e2823(0x20d)]||JSON['stringify'](_0x3e9aae[_0x5e2823(0x21c)]));this[_0x5e2823(0x228)][_0x5e2823(0x1ee)](_0x5e2823(0x1ca)+_0x53620c[_0x5e2823(0x218)]);}catch(_0x259a30){this['dashboard'][_0x5e2823(0x1ee)](_0x5e2823(0x1df)+_0x53620c['displayed_name']+':\x20'+_0x259a30['message']);}await pureDelay(0x3e8*random(0x5,0xf));}}async[_0x574b68(0x21a)](_0x517326,_0x31506d){const _0x425089=_0x574b68;this['dashboard'][_0x425089(0x1ee)](_0x425089(0x1eb)),_0x31506d[_0x425089(0x1cb)](_0x425089(0x211));let _0x1dbddd=await this[_0x425089(0x1dd)](_0x517326,_0x31506d);_0x1dbddd&&(this[_0x425089(0x228)][_0x425089(0x1ee)](_0x425089(0x1e3)),await pureDelay(0x15f90)),await this['stakeEvenlyAcrossSubnets'](_0x517326,_0x31506d);}async['_executeCriticalActionWithRetries'](_0x2e8155,_0x5ed78c,_0x2e0f5b){const _0x222eeb=_0x574b68;for(let _0x5dbe4a=0x1;_0x5dbe4a<=0x5;_0x5dbe4a++){try{_0x2e0f5b[_0x222eeb(0x1cb)](_0x5ed78c+_0x222eeb(0x20e)+_0x5dbe4a+'/5)');let _0x11933c=await _0x2e8155();if(_0x11933c&&_0x11933c[_0x222eeb(0x1e9)])return this[_0x222eeb(0x228)][_0x222eeb(0x1ee)]('[SUCCESS]\x20'+_0x5ed78c+_0x222eeb(0x217)+(_0x11933c[_0x222eeb(0x20d)]||'')),_0x2e0f5b['updateStatus'](_0x5ed78c+_0x222eeb(0x1f1)),!0x0;}catch(_0x55f15c){this['dashboard'][_0x222eeb(0x1ee)](_0x222eeb(0x1cc)+_0x5ed78c+_0x222eeb(0x200)+_0x5dbe4a+_0x222eeb(0x1d0)+_0x55f15c[_0x222eeb(0x20d)]);}_0x5dbe4a<0x5&&(_0x2e0f5b['updateStatus'](_0x5ed78c+_0x222eeb(0x204)+_0x5dbe4a+_0x222eeb(0x1ce)),await pureDelay(0x7530));}return _0x2e0f5b[_0x222eeb(0x1cb)](_0x5ed78c+_0x222eeb(0x215)),!0x1;}}