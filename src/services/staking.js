const _0x529e78=_0x3a46;function _0x3a46(_0xf226b3,_0x55f448){const _0x1af8d=_0x1af8();return _0x3a46=function(_0x3a4687,_0xdc6e2a){_0x3a4687=_0x3a4687-0x6b;let _0xb40e9a=_0x1af8d[_0x3a4687];return _0xb40e9a;},_0x3a46(_0xf226b3,_0x55f448);}(function(_0x54fbb7,_0x11fa6f){const _0x44eb57=_0x3a46,_0x23d27e=_0x54fbb7();while(!![]){try{const _0x5f1303=-parseInt(_0x44eb57(0x95))/0x1*(parseInt(_0x44eb57(0x9c))/0x2)+-parseInt(_0x44eb57(0xa0))/0x3+parseInt(_0x44eb57(0xbb))/0x4+parseInt(_0x44eb57(0x74))/0x5*(parseInt(_0x44eb57(0xa8))/0x6)+-parseInt(_0x44eb57(0x72))/0x7*(-parseInt(_0x44eb57(0xa7))/0x8)+parseInt(_0x44eb57(0xbe))/0x9*(parseInt(_0x44eb57(0x9e))/0xa)+parseInt(_0x44eb57(0xa9))/0xb;if(_0x5f1303===_0x11fa6f)break;else _0x23d27e['push'](_0x23d27e['shift']());}catch(_0x5b9a6e){_0x23d27e['push'](_0x23d27e['shift']());}}}(_0x1af8,0x99291));function _0x1af8(){const _0x1262c9=['sessionManager','s\x20for\x20balance\x20to\x20update\x20after\x20unstaking...','refreshSmartAccountBalance','filter','Bearer\x20','Staking\x20in\x20','[ERROR]\x20GetUserStakedAmount\x20failed\x20after\x20all\x20retries.','error','[ERROR]\x20FetchMarketSubnets\x20failed\x20after\x20all\x20retries.','floor','displayed_name','\x20market\x20subnets.\x20','[INFO]\x20Starting\x20unstake\x20and\x20restake\x20cycle.','Error\x20Market\x20Subnets','Unstake\x20&\x20Restake\x20Cycle','63ljkNDC','updateStatus','[INFO]\x20Found\x20','\x20failed:\x20','USER_STAKED_INFO','Staking\x20evenly\x20in\x20subnets','\x20FAILED\x20(Max\x20Retries)','10742xvIveK','_unstakeFromSubnet','20aZXaLs','\x20successful.','2450688hhZKcz','Getting\x20Staked\x20Info..','api','getUserStakedAmount','\x20subnets.\x20Checking\x20each\x20for\x20staked\x20balance.','my_staked_amount','fetch','110648JBzigz','4781928CgkzJw','3618626oWgioI','total_staked_amount','Fetching\x20Subnets..','[INFO]\x20Attempting\x20to\x20unstake\x20','ALL_MARKET_SUBNETS','.\x20Retry\x20in\x20','https://testnet.gokite.ai/','User\x20Stakes\x20Updated','allMarketSubnets','SUBNET_STAKED_INFO','stakeEvenlyAcrossSubnets','addDebugMessage','[ERROR]\x20Failed\x20to\x20stake\x20in\x20','API\x20error\x20during\x20unstake:\x20','\x20Succeeded','N/A','[WARN]\x20GetUserStakedAmount\x20attempt\x20','[INFO]\x20Waiting\x20','233096ODEfCR','\x20subnets.','[INFO]\x20Balance\x20is\x20less\x20than\x201\x20KITE,\x20nothing\x20to\x20stake.','1323468RkftpY','isArray','Unstaking\x20from\x20','Market\x20Subnets\x20Fetched','[INFO]\x20Staking\x20','length','[INFO]\x20No\x20available\x20market\x20subnets\x20found.','\x20available\x20subnets.','updateStakedAmount','unstakeFromAllSubnets','[WARN]\x20','staked_subnets','.\x20Skipping\x20unstake.','Checking\x20subnets\x20for\x20unstaking','[INFO]\x20Invalid\x20or\x20zero\x20amount\x20for\x20','[SUCCESS]\x20','userStakedInfo','DELEGATE_STAKE','data','\x20active.','userAgent','154yrCKhc','[INFO]\x20Balance\x20too\x20low\x20for\x20even\x20distribution.\x20Staking\x201\x20KITE\x20in\x20the\x20first\x20','5gpotWi','[ERROR]\x20Failed\x20to\x20unstake\x20from\x20','[INFO]\x20All\x20available\x20subnets\x20have\x20been\x20staked\x20in.\x20Stopping.','current_apr','POST','stringify','UNDELEGATE_STAKE','address','executeUnstakeAndRestakeCycle','message','_executeCriticalActionWithRetries','Could\x20not\x20fetch\x20market\x20subnets.\x20Msg:\x20','GET','availableSubnetsForStaking','\x20KITE\x20staked\x20in\x20','success','dashboard','Error\x20User\x20Stakes'];_0x1af8=function(){return _0x1262c9;};return _0x1af8();}import{API_ENDPOINTS}from'../core/api.js';const GENERAL_MAX_ATTEMPTS=0x5,GENERAL_RETRY_DELAY_MS=0x1e*0x3e8,DELAY_BETWEEN_ACTIONS_SEC_MIN=0x5,DELAY_BETWEEN_ACTIONS_SEC_MAX=0xf,POST_UNSTAKE_DELAY_SEC=0xa;async function pureDelay(_0x4ea5ad){return new Promise(_0x24340c=>setTimeout(_0x24340c,_0x4ea5ad));}function random(_0x38520d,_0x48e008){return Math['floor'](Math['random']()*(_0x48e008-_0x38520d+0x1))+_0x38520d;}export class StakingService{constructor(_0x13d679,_0x185cda,_0x38b7c5){const _0x3f6971=_0x3a46;this[_0x3f6971(0xa2)]=_0x13d679,this[_0x3f6971(0x84)]=_0x185cda,this[_0x3f6971(0x86)]=_0x38b7c5,this[_0x3f6971(0x6d)]={'total_staked_amount':0x0,'staked_subnets':[]},this[_0x3f6971(0x81)]=[],this[_0x3f6971(0xb1)]=[];}async[_0x529e78(0xa3)](_0x533aed,_0x55905e,_0x41f6e5=!![]){const _0x406206=_0x529e78,_0xa1bca=[0x2bf20,0x33450,0x493e0];for(let _0x59d06c=0x0;_0x59d06c<_0xa1bca[_0x406206(0xc3)];_0x59d06c++){try{if(_0x41f6e5)_0x55905e['updateStatus'](_0x406206(0xa1));const _0x453cb0=await this[_0x406206(0xa2)]['fetch'](API_ENDPOINTS[_0x406206(0x99)],_0x406206(0x80),_0x406206(0x8a)+_0x533aed,{},{'Referer':'https://testnet.gokite.ai/'},_0xa1bca[_0x59d06c],_0x55905e['userAgent']);if(_0x453cb0[_0x406206(0x8d)]||!_0x453cb0[_0x406206(0x6f)]?.[_0x406206(0x6f)])throw new Error('Could\x20not\x20get\x20user\x27s\x20staked\x20summary.\x20Msg:\x20'+(_0x453cb0[_0x406206(0x7d)]||JSON[_0x406206(0x79)](_0x453cb0[_0x406206(0x6f)])));this[_0x406206(0x6d)]=_0x453cb0[_0x406206(0x6f)][_0x406206(0x6f)];if(!this[_0x406206(0x6d)]['staked_subnets'])this[_0x406206(0x6d)][_0x406206(0xc9)]=[];if(_0x41f6e5)this[_0x406206(0x84)]['addDebugMessage']('[SUCCESS]\x20User\x27s\x20Total\x20Staked:\x20'+(this[_0x406206(0x6d)][_0x406206(0xaa)]||_0x406206(0xb8))+'.');_0x55905e[_0x406206(0xc6)](this['userStakedInfo']['total_staked_amount']);if(_0x41f6e5)_0x55905e[_0x406206(0x96)](_0x406206(0xb0));return this['userStakedInfo'];}catch(_0x49fc3f){this[_0x406206(0x84)][_0x406206(0xb4)](_0x406206(0xb9)+(_0x59d06c+0x1)+_0x406206(0x98)+_0x49fc3f[_0x406206(0x7d)]);if(_0x59d06c<_0xa1bca['length']-0x1)await pureDelay(0x1388);else{this['dashboard'][_0x406206(0xb4)](_0x406206(0x8c)),_0x55905e[_0x406206(0x96)](_0x406206(0x85)),this[_0x406206(0x6d)]={'total_staked_amount':0x0,'staked_subnets':[]},_0x55905e[_0x406206(0xc6)](0x0);throw _0x49fc3f;}}}}async['fetchAvailableMarketSubnets'](_0x446cd3,_0x31a04a){const _0x1590e5=_0x529e78,_0x48a4f4=[0x2bf20,0x33450,0x493e0];for(let _0x4efaf5=0x0;_0x4efaf5<_0x48a4f4[_0x1590e5(0xc3)];_0x4efaf5++){try{_0x31a04a[_0x1590e5(0x96)](_0x1590e5(0xab));const _0x40f69d=await this[_0x1590e5(0xa2)][_0x1590e5(0xa6)](API_ENDPOINTS[_0x1590e5(0xad)],'GET',_0x1590e5(0x8a)+_0x446cd3,{},{'Referer':'https://testnet.gokite.ai/'},_0x48a4f4[_0x4efaf5],_0x31a04a[_0x1590e5(0x71)]);if(_0x40f69d[_0x1590e5(0x8d)]||!_0x40f69d[_0x1590e5(0x6f)]?.[_0x1590e5(0x6f)]||!Array[_0x1590e5(0xbf)](_0x40f69d[_0x1590e5(0x6f)][_0x1590e5(0x6f)]))throw new Error(_0x1590e5(0x7f)+(_0x40f69d['message']||JSON['stringify'](_0x40f69d[_0x1590e5(0x6f)])));this[_0x1590e5(0xb1)]=_0x40f69d['data']['data']['filter'](_0x281bd6=>_0x281bd6&&_0x281bd6['id']&&_0x281bd6[_0x1590e5(0x7b)]),this[_0x1590e5(0x81)]=this[_0x1590e5(0xb1)][_0x1590e5(0x89)](_0x59a2fa=>typeof _0x59a2fa[_0x1590e5(0x77)]==='number'&&_0x59a2fa[_0x1590e5(0x77)]>0x0),this[_0x1590e5(0x84)][_0x1590e5(0xb4)]('[SUCCESS]\x20Fetched\x20'+this['allMarketSubnets'][_0x1590e5(0xc3)]+_0x1590e5(0x91)+this[_0x1590e5(0x81)][_0x1590e5(0xc3)]+_0x1590e5(0x70)),_0x31a04a[_0x1590e5(0x96)](_0x1590e5(0xc1));return;}catch(_0x4bc062){this[_0x1590e5(0x84)][_0x1590e5(0xb4)]('[WARN]\x20FetchMarketSubnets\x20attempt\x20'+(_0x4efaf5+0x1)+_0x1590e5(0x98)+_0x4bc062[_0x1590e5(0x7d)]);if(_0x4efaf5<_0x48a4f4['length']-0x1)await pureDelay(0x1388);else{this['dashboard'][_0x1590e5(0xb4)](_0x1590e5(0x8e)),_0x31a04a[_0x1590e5(0x96)](_0x1590e5(0x93)),this['allMarketSubnets']=[],this['availableSubnetsForStaking']=[];throw _0x4bc062;}}}}async['_unstakeFromSubnet'](_0x5a5f34,_0x3ea378,_0x4eb889,_0x870747){const _0x2483f3=_0x529e78,_0x4906e9=Math['floor'](parseFloat(_0x4eb889));if(isNaN(_0x4906e9)||_0x4906e9<=0x0)return this['dashboard'][_0x2483f3(0xb4)](_0x2483f3(0x6b)+_0x3ea378[_0x2483f3(0x90)]+_0x2483f3(0xca)),!![];_0x870747['updateStatus'](_0x2483f3(0xc0)+_0x3ea378[_0x2483f3(0x90)]),this['dashboard'][_0x2483f3(0xb4)](_0x2483f3(0xac)+_0x4906e9+'\x20KITE\x20from\x20'+_0x3ea378[_0x2483f3(0x90)]+'...');try{const _0x3e76ee=await this['api'][_0x2483f3(0xa6)](API_ENDPOINTS[_0x2483f3(0x7a)],_0x2483f3(0x78),_0x2483f3(0x8a)+_0x5a5f34,{'subnet_address':_0x3ea378[_0x2483f3(0x7b)],'amount':_0x4906e9},{'Referer':_0x2483f3(0xaf)},undefined,_0x870747[_0x2483f3(0x71)]);if(_0x3e76ee[_0x2483f3(0x8d)])throw new Error(_0x2483f3(0xb6)+(_0x3e76ee[_0x2483f3(0x7d)]||JSON[_0x2483f3(0x79)](_0x3e76ee[_0x2483f3(0x6f)])));return this['dashboard'][_0x2483f3(0xb4)]('[SUCCESS]\x20Unstake\x20from\x20'+_0x3ea378[_0x2483f3(0x90)]+_0x2483f3(0x9f)),!![];}catch(_0x53a0b9){return this[_0x2483f3(0x84)]['addDebugMessage'](_0x2483f3(0x75)+_0x3ea378[_0x2483f3(0x90)]+':\x20'+_0x53a0b9[_0x2483f3(0x7d)]),![];}}async[_0x529e78(0xc7)](_0xe4c862,_0x31d231){const _0x413a5f=_0x529e78;_0x31d231['updateStatus'](_0x413a5f(0xcb)),await this['fetchAvailableMarketSubnets'](_0xe4c862,_0x31d231);const _0x16fa5b=this[_0x413a5f(0xb1)]||[];if(_0x16fa5b[_0x413a5f(0xc3)]===0x0)return this[_0x413a5f(0x84)]['addDebugMessage'](_0x413a5f(0xc4)),![];this[_0x413a5f(0x84)][_0x413a5f(0xb4)]('[INFO]\x20Found\x20'+_0x16fa5b['length']+_0x413a5f(0xa4));let _0x36c346=![];for(const _0x1ca356 of _0x16fa5b){try{const _0x5e9c27=await this[_0x413a5f(0xa2)][_0x413a5f(0xa6)](API_ENDPOINTS[_0x413a5f(0xb2)](_0x1ca356['id']),_0x413a5f(0x80),_0x413a5f(0x8a)+_0xe4c862,{},{'Referer':'https://testnet.gokite.ai/'},undefined,_0x31d231['userAgent']),_0x3299bc=_0x5e9c27?.[_0x413a5f(0x6f)]?.[_0x413a5f(0x6f)]?.[_0x413a5f(0xa5)];_0x3299bc&&parseFloat(_0x3299bc)>0x0&&(this[_0x413a5f(0x84)][_0x413a5f(0xb4)](_0x413a5f(0x97)+_0x3299bc+_0x413a5f(0x82)+_0x1ca356[_0x413a5f(0x90)]+'.'),await this[_0x413a5f(0x9d)](_0xe4c862,_0x1ca356,_0x3299bc,_0x31d231),_0x36c346=!![],await pureDelay(random(DELAY_BETWEEN_ACTIONS_SEC_MIN,DELAY_BETWEEN_ACTIONS_SEC_MAX)*0x3e8));}catch(_0x31e310){this[_0x413a5f(0x84)][_0x413a5f(0xb4)]('[WARN]\x20Could\x20not\x20check\x20staked\x20amount\x20for\x20'+_0x1ca356['displayed_name']+':\x20'+_0x31e310[_0x413a5f(0x7d)]);}}return _0x36c346;}async[_0x529e78(0xb3)](_0x30716e,_0x4c30a6){const _0x16a997=_0x529e78;_0x4c30a6[_0x16a997(0x96)](_0x16a997(0x9a)),await this['fetchAvailableMarketSubnets'](_0x30716e,_0x4c30a6);if(this[_0x16a997(0x81)][_0x16a997(0xc3)]===0x0){this['dashboard']['addDebugMessage']('[WARN]\x20No\x20available\x20subnets\x20to\x20stake\x20in.');return;}const _0x1ffe3d=await _0x4c30a6[_0x16a997(0x88)](_0x30716e),_0x211ac7=parseFloat(_0x1ffe3d);if(_0x211ac7<0x1){this['dashboard'][_0x16a997(0xb4)](_0x16a997(0xbd));return;}const _0x5e380b=this[_0x16a997(0x81)],_0x3bf2fa=Math[_0x16a997(0x8f)](_0x211ac7/_0x5e380b['length']);if(_0x3bf2fa<0x1){const _0x5ef264=Math[_0x16a997(0x8f)](_0x211ac7);this[_0x16a997(0x84)][_0x16a997(0xb4)](_0x16a997(0x73)+_0x5ef264+_0x16a997(0xc5));for(let _0x517261=0x0;_0x517261<_0x5ef264;_0x517261++){if(_0x517261>=_0x5e380b['length']){this[_0x16a997(0x84)][_0x16a997(0xb4)](_0x16a997(0x76));break;}const _0x3d8462=_0x5e380b[_0x517261];try{await this[_0x16a997(0xa2)][_0x16a997(0xa6)](API_ENDPOINTS[_0x16a997(0x6e)],'POST',_0x16a997(0x8a)+_0x30716e,{'subnet_address':_0x3d8462[_0x16a997(0x7b)],'amount':0x1},{'Referer':_0x16a997(0xaf)},undefined,_0x4c30a6[_0x16a997(0x71)]),this[_0x16a997(0x84)]['addDebugMessage']('[SUCCESS]\x20Staked\x201\x20KITE\x20in\x20'+_0x3d8462['displayed_name']);}catch(_0x5f1f44){this[_0x16a997(0x84)][_0x16a997(0xb4)](_0x16a997(0xb5)+_0x3d8462[_0x16a997(0x90)]+':\x20'+_0x5f1f44['message']);}await pureDelay(random(DELAY_BETWEEN_ACTIONS_SEC_MIN,DELAY_BETWEEN_ACTIONS_SEC_MAX)*0x3e8);}return;}this[_0x16a997(0x84)][_0x16a997(0xb4)](_0x16a997(0xc2)+_0x3bf2fa+'\x20KITE\x20in\x20each\x20of\x20'+_0x5e380b[_0x16a997(0xc3)]+_0x16a997(0xbc));for(const _0x2b4948 of _0x5e380b){try{_0x4c30a6[_0x16a997(0x96)](_0x16a997(0x8b)+_0x2b4948[_0x16a997(0x90)]);const _0x1c92b2=await this[_0x16a997(0xa2)]['fetch'](API_ENDPOINTS[_0x16a997(0x6e)],_0x16a997(0x78),_0x16a997(0x8a)+_0x30716e,{'subnet_address':_0x2b4948[_0x16a997(0x7b)],'amount':_0x3bf2fa},{'Referer':_0x16a997(0xaf)},undefined,_0x4c30a6[_0x16a997(0x71)]);if(_0x1c92b2[_0x16a997(0x8d)])throw new Error(_0x1c92b2[_0x16a997(0x7d)]||JSON[_0x16a997(0x79)](_0x1c92b2['data']));this[_0x16a997(0x84)]['addDebugMessage']('[SUCCESS]\x20Staked\x20in\x20'+_0x2b4948[_0x16a997(0x90)]);}catch(_0x364e5d){this['dashboard']['addDebugMessage'](_0x16a997(0xb5)+_0x2b4948['displayed_name']+':\x20'+_0x364e5d[_0x16a997(0x7d)]);}await pureDelay(random(DELAY_BETWEEN_ACTIONS_SEC_MIN,DELAY_BETWEEN_ACTIONS_SEC_MAX)*0x3e8);}}async[_0x529e78(0x7c)](_0x40a054,_0x46f9db){const _0x5ea7df=_0x529e78;this[_0x5ea7df(0x84)][_0x5ea7df(0xb4)](_0x5ea7df(0x92)),_0x46f9db['updateStatus'](_0x5ea7df(0x94));const _0x17336f=await this[_0x5ea7df(0xc7)](_0x40a054,_0x46f9db);_0x17336f&&(this[_0x5ea7df(0x84)]['addDebugMessage'](_0x5ea7df(0xba)+POST_UNSTAKE_DELAY_SEC+_0x5ea7df(0x87)),await pureDelay(POST_UNSTAKE_DELAY_SEC*0x3e8)),await this[_0x5ea7df(0xb3)](_0x40a054,_0x46f9db);}async[_0x529e78(0x7e)](_0x1d0ca2,_0x531793,_0x52646f){const _0x389c3f=_0x529e78;for(let _0x22dfbc=0x1;_0x22dfbc<=GENERAL_MAX_ATTEMPTS;_0x22dfbc++){try{_0x52646f[_0x389c3f(0x96)](_0x531793+'\x20(Attempt\x20'+_0x22dfbc+'/'+GENERAL_MAX_ATTEMPTS+')');const _0x19824d=await _0x1d0ca2();if(_0x19824d&&_0x19824d[_0x389c3f(0x83)])return this[_0x389c3f(0x84)][_0x389c3f(0xb4)](_0x389c3f(0x6c)+_0x531793+'\x20process\x20complete.\x20'+(_0x19824d[_0x389c3f(0x7d)]||'')),_0x52646f[_0x389c3f(0x96)](_0x531793+_0x389c3f(0xb7)),!![];}catch(_0x516190){this['dashboard'][_0x389c3f(0xb4)](_0x389c3f(0xc8)+_0x531793+'\x20attempt\x20'+_0x22dfbc+_0x389c3f(0x98)+_0x516190[_0x389c3f(0x7d)]);}_0x22dfbc<GENERAL_MAX_ATTEMPTS&&(_0x52646f[_0x389c3f(0x96)](_0x531793+'\x20Fail\x20'+_0x22dfbc+_0x389c3f(0xae)+GENERAL_RETRY_DELAY_MS/0x3e8+'s'),await pureDelay(GENERAL_RETRY_DELAY_MS));}return _0x52646f['updateStatus'](_0x531793+_0x389c3f(0x9b)),![];}}